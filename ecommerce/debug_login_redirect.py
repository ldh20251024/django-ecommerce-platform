import osimport django# å…ˆè®¾ç½®djangoç¯å¢ƒ,æ‰èƒ½å¯¼å…¥åé¢é‚£äº›æ¨¡å—å’Œåº”ç”¨os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'ecommerce.settings')django.setup()from django.test import Clientfrom django.urls import reversefrom django.contrib.auth import get_user_modelfrom django.conf import settingsfrom shop.models import Category, Productimport uuid# ç¡®ä¿ testserver åœ¨ ALLOWED_HOSTS ä¸­if 'testserver' not in settings.ALLOWED_HOSTS:    settings.ALLOWED_HOSTS.append('testserver')User = get_user_model()# åˆ›å»ºæµ‹è¯•å®¢æˆ·ç«¯client = Client()# åˆ›å»ºæµ‹è¯•ç”¨æˆ·user = User.objects.create_user(    username='testuser',    email='test@example.com',    password='testpass123')try:    print("=== æµ‹è¯•ç™»å½•é‡å®šå‘åŠŸèƒ½ ===")    # æµ‹è¯•1ï¼šç›´æ¥è®¿é—®ç™»å½•é¡µé¢ï¼ˆæ²¡æœ‰nextå‚æ•°ï¼‰    print("æµ‹è¯•1ï¼šç›´æ¥è®¿é—®ç™»å½•é¡µé¢")    response = client.get(reverse('accounts:login'))    print(f"çŠ¶æ€ç : {response.status_code}")    # æ£€æŸ¥è¡¨å•ä¸­æ˜¯å¦æœ‰nextéšè—å­—æ®µ    content = response.content.decode()    if 'name="next"' in content:        print("âœ“ æ‰¾åˆ°nextéšè—å­—æ®µ")    else:        print("âœ— æœªæ‰¾åˆ°nextéšè—å­—æ®µ")    # æµ‹è¯•2ï¼šè®¿é—®å—ä¿æŠ¤é¡µé¢ï¼ˆè®¢å•åˆ›å»ºï¼‰ï¼Œåº”è¯¥é‡å®šå‘åˆ°ç™»å½•é¡µé¢å¹¶æºå¸¦nextå‚æ•°    print("\næµ‹è¯•2ï¼šè®¿é—®å—ä¿æŠ¤çš„è®¢å•åˆ›å»ºé¡µé¢")    response = client.get(reverse('orders:order_create'), follow=True)    print(f"æœ€ç»ˆçŠ¶æ€ç : {response.status_code}")    # æ£€æŸ¥æ˜¯å¦é‡å®šå‘åˆ°ç™»å½•é¡µé¢å¹¶æºå¸¦nextå‚æ•°    if response.redirect_chain:        last_redirect = response.redirect_chain[-1][0]        print(last_redirect)        if 'accounts/login' in last_redirect and 'next=' in last_redirect:            print("âœ“ æ­£ç¡®é‡å®šå‘åˆ°ç™»å½•é¡µé¢å¹¶æºå¸¦nextå‚æ•°")        else:            print("âœ— é‡å®šå‘ä¸æ­£ç¡®")            print(f"é‡å®šå‘é“¾: {response.redirect_chain}")    else:        print("âœ— æ²¡æœ‰å‘ç”Ÿé‡å®šå‘")    # æµ‹è¯•3ï¼šç™»å½•åé‡å®šå‘    print("\næµ‹è¯•3ï¼šç™»å½•åé‡å®šå‘æµ‹è¯•")    unique_id = uuid.uuid4()    unique_id_str = str(unique_id)    category = Category.objects.create(        name='test' + unique_id_str,        slug='testslug' + unique_id_str    )    product = Product.objects.create(        category=category,        name='iPhone 13',        slug='iphone-13',        description='è‹¹æœæ‰‹æœº',        price=5999.00,        stock=100    )    # åœ¨ç™»å½•å‰å…ˆæ·»åŠ å•†å“åˆ°è´­ç‰©è½¦ï¼ˆåŒ¿åè´­ç‰©è½¦ï¼‰    client.post(reverse('cart:cart_add', args=[product.id]), {        'quantity': 2,        'update': False    })    # å…ˆè®¿é—®è®¢å•åˆ›å»ºé¡µé¢è·å–nextå‚æ•°    client.get(reverse('orders:order_create'))    # ç™»å½•    login_url = reverse('accounts:login')    response = client.post(login_url, {        'username': 'testuser',        'password': 'testpass123',        'next': reverse('orders:order_create')    }, follow=True)    print(f"ç™»å½•åçŠ¶æ€ç : {response.status_code}")    print(f"ç™»å½•åURL: {response.wsgi_request.path}")    if response.wsgi_request.path == reverse('orders:order_create'):        print("âœ“ ç™»å½•åæˆåŠŸé‡å®šå‘åˆ°è®¢å•åˆ›å»ºé¡µé¢")    else:        print("âœ— ç™»å½•åé‡å®šå‘å¤±è´¥")        print(f"å®é™…è·¯å¾„: {response.wsgi_request.path}")        print(f"æœŸæœ›è·¯å¾„: {reverse('orders:order_create')}")    print("ğŸ‰ ç™»å½•é‡å®šå‘åŠŸèƒ½æµ‹è¯•å®Œæˆï¼")finally:    # æ¸…ç†æµ‹è¯•æ•°æ®    user.delete()